---
export interface TimelineItem {
  slug: string
  title: string
  date: string
  pinned?: boolean
}

interface Props {
  items: TimelineItem[]
}

const { items } = Astro.props

// 按年份分组
const groupedByYear = items.reduce(
  (acc, item) => {
    const year = item.date.slice(0, 4)
    if (!acc[year]) {
      acc[year] = []
    }
    acc[year].push(item)
    return acc
  },
  {} as Record<string, TimelineItem[]>,
)

// 按年份降序排列
const years = Object.keys(groupedByYear).sort((a, b) => Number(b) - Number(a))

// 格式化日期显示（月-日）
const formatDate = (dateStr: string) => {
  const [, month, day] = dateStr.split("-")
  return `${month}-${day}`
}
---

<section class="timeline-section py-16 px-6">
  <div class="max-w-3xl mx-auto">
    <!-- 页面标题 -->
    <div class="mb-12 onload-animation" style="animation-delay: 50ms;">
      <span class="text-primary text-sm font-medium tracking-wide uppercase mb-2 block">
        Timeline
      </span>
      <h1 class="font-serif text-3xl sm:text-4xl font-medium text-foreground">
        文章归档
      </h1>
      <p class="mt-3 text-muted-foreground">
        共 {items.length} 篇文章
      </p>
    </div>

    <!-- 时间线 -->
    <div class="timeline">
      {
        years.map((year, yearIndex) => (
          <div
            class="year-group mb-8 onload-animation"
            style={`animation-delay: ${100 + yearIndex * 50}ms;`}
          >
            {/* 年份标题 */}
            <div class="year-header flex items-center gap-4 mb-6">
              <span class="text-2xl font-serif font-semibold text-foreground">
                {year}
              </span>
              <span class="text-sm text-muted-foreground">
                {groupedByYear[year].length} 篇
              </span>
              <div class="flex-1 h-px bg-border" />
            </div>

            {/* 该年份的文章列表 */}
            <ul class="article-list space-y-2 pl-6 border-l border-border/40">
              {groupedByYear[year].map((item, itemIndex) => (
                <li
                  class="article-item onload-animation"
                  style={`animation-delay: ${150 + yearIndex * 50 + itemIndex * 30}ms;`}
                >
                  <a
                    href={`/posts/${item.slug}/`}
                    class="article-link group flex items-baseline gap-4 py-1.5 px-3 -ml-3 rounded-lg transition-colors duration-200 hover:bg-muted/50"
                  >
                    {/* 日期 */}
                    <time class="date text-sm text-muted-foreground font-mono shrink-0 w-14">
                      {formatDate(item.date)}
                    </time>

                    {/* 标题 */}
                    <span class="title font-serif text-foreground group-hover:text-primary transition-colors duration-200 leading-relaxed">
                      {item.pinned && (
                        <span class="inline-flex items-center mr-2 text-primary">
                          <svg
                            class="w-3.5 h-3.5"
                            fill="currentColor"
                            viewBox="0 0 20 20"
                          >
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                          </svg>
                        </span>
                      )}
                      {item.title}
                    </span>
                  </a>
                </li>
              ))}
            </ul>
          </div>
        ))
      }
    </div>
  </div>
</section>

<style>
  /* 响应式调整 */
  @media (max-width: 640px) {
    .article-link {
      flex-direction: column;
      gap: 0.25rem;
    }

    .date {
      width: auto;
    }
  }
</style>
